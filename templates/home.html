<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Home Page</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <style>
     body {
        background-color: #2c2c2c;
        color: #435279;
        padding: 20px;
      }
      body::-webkit-scrollbar {
      display: none; /* for Chrome, Safari, and Opera */
      }
      
      .bg-image {
        background-image: url("{{ url_for('static', filename='img/bg.jpg') }}");
        background-size: cover;
        background-position: center;
        background-attachment: fixed;
      }

      .navbar {
        background-color: transparent;
      }
      
      .navbar-brand,
      .navbar-nav .nav-link {
        color: #00BFFF;
      }
      
      .navbar-brand:hover,
      .navbar-nav .nav-link:hover {
        color: #ffffff;
        text-underline-position: below;
      }
      .navbar-nav li a {
        font-size: 1.2em; /* adjust the font size as needed */
        font-weight: bold;
      }
      
      .gradient-text {
        background: linear-gradient(to right, #2747ff, #11226f);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      
      .poppins-text {
        font-family: 'Poppins', sans-serif;
        font-size: 5rem; /* or any other size you prefer */
        text-align: center;
        padding-top: 50px;
        background: linear-gradient(to right, #2a31ff, #1d8e07, #000000);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      .poppins-text_med {
        font-family: 'Poppins', sans-serif;
        font-size: 3rem; /* or any other size you prefer */
        text-align: center;
        padding-top: 50px;
        background: linear-gradient(to right, #2a31ff, #1d8e07, #000000);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      .switch {
        padding: 20px;
        text-align: center;
      }
      
      .scrollable {
        overflow-y: scroll;
      }
      
      .card {
        background-color: rgba(4, 4, 4, 0);
        color: white;
        margin-top: 20px;
        padding-right: 20px;
        border: 1px solid #00BFFF;
      }
      
      .card-title {
        font-size: 24px;
        color: #00BFFF;
      }
      
      .card-text {
        font-size: 18px;
        color: #00BFFF;
      }
      
      .value {
        font-size: 32px;
      }
      
      .graph {
        width: 100%;
        height: 200px;
        margin-top: 10px;
      }
      .font-load{
        font-family: 'Poppins', sans-serif;
        font-size: 1.2rem; /* or any other size you prefer */
        /* text-align: center; */
        padding-top: 10px;
        color: #ffffff;
      }
      
      /* Styles for the round buttons */
      .round-button {
        border-radius: 50%;
        width: 80px;
        height: 80px;
        font-size: 20px;
        color: #ffffff;
        text-align: center;
        line-height: 80px;
      }
      
      /* Styles for the "ON" button */
      .on-button {
        background-color: #04ae2c;
      }
      
      /* Styles for the "OFF" button */
      .off-button {
        background-color: #d80016;
      }
      
      /* Styles for the list */
      .list-group-item {
        cursor: pointer;
        background-color: transparent;
        border: 1px solid #00BFFF;
        padding-bottom: 10px;
      }
      .list-font{
        font-family: 'Poppins', sans-serif;
        font-size: 1.2rem; /* or any other size you prefer */
        /* text-align: center; */
        font-weight: bold;
        padding-top: 10px;
        background: linear-gradient(to right, #353cf6, #1d8e07, #000000);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
      }
      
      .load-switch {
        margin-top: 20px;
        margin-bottom: 20px;
      }
      
      .load-label {
        color: #00BFFF;
        font-size: 18px;
        margin-right: 10px;
      }
      
      .load-input {
        width: 60px;
        height: 34px;
        margin-right: 10px;
      }

      .button {
        display: inline-block;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        color: white;
        font-size: 1.2em;
        font-weight: bold;
        cursor: pointer;
      }

      .save {
        background-color: rgb(30, 80, 232);
      }

      .reset {
        background-color: transparent;
        border: 1px solid #00BFFF;
      }

      .button:hover {
        opacity: 0.8;
      }

      .button-container {
        text-align: center;
        margin-top: 20px;
      }

    </style>
  </head>
  <body class="bg-image">
    <div>
      <nav class="navbar navbar-expand-lg">
        <a class="navbar-brand" href="#"> <img src="{{ url_for('static', filename='img/icon.png') }}" alt="Logo" height="70px" > </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item active">
              <a class="nav-link navbar-nav li a" href="#">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link navbar-nav li a" href="#">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link navbar-nav li a" href="#">Services</a>
            </li>
            <li class="nav-item">
              <a class="nav-link navbar-nav li a" href="#">Contact</a>
            </li>
          </ul>
        </div>
      </nav>
      <h2 class="poppins-text">ESAM</h2>
      <div>
        <!-- meters -->
        <div>
          <h3 class="poppins-text_med">Live monitoring</h3>
          <div class="row">
            <div class="col-md-4">
              <div class="card bg-blue text-white">
                <div class="card-body">
                  <h5 class="card-title">Load 1</h5>
                  <canvas id="chart1" height="100"></canvas>
                  <p class="card-text">Voltage: <span id="load1Voltage"></span></p>
                  <p class="card-text">Current: <span id="load1Current"></span></p>
                  <p class="card-text">Energy: <span id="load1Energy"></span></p>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card bg-blue text-white">
                <div class="card-body">
                  <h5 class="card-title">Load 2</h5>
                  <canvas id="load2Chart" height="100"></canvas>
                  <p class="card-text">Voltage: <span id="load2Voltage"></span></p>
                  <p class="card-text">Current: <span id="load2Current"></span></p>
                  <p class="card-text">Energy: <span id="load2Energy"></span></p>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card bg-blue text-white">
                <div class="card-body">
                  <h5 class="card-title">Load 3</h5>
                  <canvas id="load3Chart" height="100"></canvas>
                  <p class="card-text">Voltage: <span id="load3Voltage"></span></p>
                  <p class="card-text">Current: <span id="load3Current"></span></p>
                  <p class="card-text">Energy: <span id="load3Energy"></span></p>
                </div>
              </div>
            </div>
          </div>
        </div>
        
        <!-- meters -->

          <br>
          <div>
            <h3 class="poppins-text_med">Manual Controls</h3>
            <div class="row switch">
              <div class="col-md-4">
                <button class="round-button off-button">OFF</button>
                <h5 class="font-load">Load 1</h5>
                <!-- <button class="round-button off-button">OFF</button> -->
              </div>
              <div class="col-md-4">
                <button class="round-button off-button">OFF</button>
                <h5 class="font-load">Load 2</h5>
                <!-- <button class="round-button off-button">OFF</button> -->
              </div>
              <div class="col-md-4">
                <button class="round-button off-button" onclick="sendStatus()">OFF</button>
                <h5 class="font-load">Load 3</h5>
                <!-- <button class="round-button off-button">OFF</button> -->
              </div>
            </div>
          </div>
          <br>
          <h4 class="poppins-text_med">Load Priority</h4>
          <div class="row">
            <div class="col-md-3">
              <div class="button-container">
                <button class="button save">Save</button>
                <button class="button reset">Reset</button>
              </div>
            </div>
              <div class="col-md-6">
                <ul class="list-group" id="sortableList">
                  <li class="list-group-item list-font">Item 1</li>
                  <li class="list-group-item list-font">Item 2</li>
                  <li class="list-group-item list-font">Item 3</li>
                  <!-- <li class="list-group-item">Item 4</li>
                  <li class="list-group-item">Item 5</li> -->
                </ul>
              </div>              
          </div>
        </div>
      </div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
    <script>
      // Code for the sortable list
      $( function() {
        $( "#sortableList" ).sortable();
        $( "#sortableList" ).disableSelection();
      } );
      
      // Code for updating the meter values
      function updateMeterValues() {
        var meter1Value = Math.floor(Math.random() * 100);
        var meter2Value = Math.floor(Math.random() * 100);
        $('#meter1Value').text(meter1Value + " units");
        $('#meter2Value').text(meter2Value + " units");
      }
      
      // Code for updating the button colors and labels on click
      $(document).ready(function() {
        $('.round-button').click(function() {
          if ($(this).hasClass('on-button')) {
            $(this).removeClass('on-button');
            $(this).addClass('off-button');
            $(this).text('OFF');
          } else {
            $(this).removeClass('off-button');
            $(this).addClass('on-button');
            $(this).text('ON');
          }
        });
      });
      
      // Code for calling the updateMeterValues function every 2 seconds
      setInterval(function() {
        updateMeterValues();
      }, 2000);
    </script>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <script>
      
      // Load 2 chart
      var load2Chart = new Chart(document.getElementById("load2Chart"), {
        // ...
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'Voltage',
            data: [],
            borderColor: '#ff6384',
            fill: false
          }, {
            label: 'Current',
            data: [],
            borderColor: '#36a2eb',
            fill: false
          }, {
            label: 'Energy',
            data: [],
            borderColor: '#ffce56',
            fill: false
          }]
        },
        options: {
          responsive: true,
          scales: {
            xAxes: [{
              display: true
            }],
            yAxes: [{
              display: true,
              ticks: {
                beginAtZero: true
              }
            }]
          }
        }
      });
      
      // Load 3 chart
      var load3Chart = new Chart(document.getElementById("load3Chart"), {
        // ...
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'Voltage',
            data: [],
            borderColor: '#ff6384',
            fill: false
          }, {
            label: 'Current',
            data: [],
            borderColor: '#36a2eb',
            fill: false
          }, {
            label: 'Energy',
            data: [],
            borderColor: '#ffce56',
            fill: false
          }]
        },
        options: {
          responsive: true,
          scales: {
            xAxes: [{
              display: true
            }],
            yAxes: [{
              display: true,
              ticks: {
                beginAtZero: true
              }
            }]
          }
        }
      });
      
      // Load 1 chart
      var chart1 = new Chart(document.getElementById("chart1"), {
        type: 'line',
        data: {
          labels: [],
          datasets: [{
            label: 'Voltage',
            data: [],
            borderColor: '#ff6384',
            fill: false
          }, {
            label: 'Current',
            data: [],
            borderColor: '#36a2eb',
            fill: false
          }, {
            label: 'Energy',
            data: [],
            borderColor: '#ffce56',
            fill: false
          }]
        },
        options: {
          responsive: true,
          scales: {
            xAxes: [{
              display: true
            }],
            yAxes: [{
              display: true,
              ticks: {
                beginAtZero: true
              }
            }]
          }
        }
      });

      var socket = io.connect('http://127.0.0.1:5000');

      socket.on('data', function(data) {
        var time = new Date().toLocaleTimeString();
        if (chart1.data.labels.length >= 10) {
          chart1.data.labels.shift();
          chart1.data.datasets[0].data.shift();
          chart1.data.datasets[1].data.shift();
          chart1.data.datasets[2].data.shift();
        }
        chart1.data.labels.push(time);
        chart1.data.datasets[0].data.push(data.voltage1);
        chart1.data.datasets[1].data.push(data.current1);
        chart1.data.datasets[2].data.push(data.energy1);
        chart1.update();

        if (load2Chart.data.labels.length >= 10) {
          load2Chart.data.labels.shift();
          load2Chart.data.datasets[0].data.shift();
          load2Chart.data.datasets[1].data.shift();
          load2Chart.data.datasets[2].data.shift();
        }
        load2Chart.data.labels.push(time);
        load2Chart.data.datasets[0].data.push(data.voltage2);
        load2Chart.data.datasets[1].data.push(data.current2);
        load2Chart.data.datasets[2].data.push(data.energy2);
        load2Chart.update();

        if (load3Chart.data.labels.length >= 10) {
          load3Chart.data.labels.shift();
          load3Chart.data.datasets[0].data.shift();
          load3Chart.data.datasets[1].data.shift();
          load3Chart.data.datasets[2].data.shift();
        }
        load3Chart.data.labels.push(time);
        load3Chart.data.datasets[0].data.push(data.voltage3);
        load3Chart.data.datasets[1].data.push(data.current3);
        load3Chart.data.datasets[2].data.push(data.energy3);
        load3Chart.update();
      });

      
    </script>
  </body>
</html>
